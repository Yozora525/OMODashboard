<!DOCTYPE html>
<html>

{% include '/frame/head.html' %}
<script type="text/javascript" src="../static/js/pageFunction/dashboard.js"></script>
<script type="text/javascript" src="../static/js/doc.ready/dashboard.js"></script>
<link rel="stylesheet" type="text/css" href="../static/css/dashboard.css" />
<style>
</style>

<body>
    {% include '/frame/header.html' %}
    <div class="dashboard">
        <div class="sidebar">
            <div class="sidebar-title">OMO</div>
            <div class="section section-a">
                <div class="section-title"><a href="/dashboard" target="_blank">儀錶板</a></div>
            </div>
            <div class="section section-b">
                <div class="section-title"><a href="/customer" target="_blank">顧客管理</a></div>
            </div>
            <div class="section section-c">
                <div class="section-title"><a href="/supplier" target="_blank">供應商管理</a></div>
            </div>
            <div class="section section-d" onclick="">
                <div class="section-title">......</div>
            </div>
        </div>
        <div class="section section-a" id="section-a">
            <div class="section-title">A. 客戶分析</div>
            <div class="subsection">
                <div class="chart" style="height: 355px;">
                    <label>潛在客戶漏斗分析</label>
                    <div class="custom-legend">
                        <div class="legend-item" onclick="toggleDataset(0)">
                            <div class="legend-color" style="background-color: #ff6384;"></div>
                            <div>參與實體銷售會人數/公共按摩椅者/廣告觸及次數</div>
                        </div>
                        <div class="legend-item" onclick="toggleDataset(1)">
                            <div class="legend-color" style="background-color: #36a2eb;"></div>
                            <div>加入會員/到店使用體驗券</div>
                        </div>
                        <div class="legend-item" onclick="toggleDataset(2)">
                            <div class="legend-color" style="background-color: #ffce56;"></div>
                            <div>購買按摩椅的忠實顧客</div>
                        </div>
                    </div>
                    <canvas id="funnelchart" style="width: 300px; height: 200px;"></canvas>
                </div>
                <div class="chart" style="height: 355px;">
                    <label>潛在客戶來源</label>
                    <canvas id="clientpiechart"></canvas>
                </div>
            </div>
        </div>

        <div class="section section-b" id="section-b">
            <div class="section-title">B. 個別銷售狀況</div>
            <div class="subsection">
                <div class="chart" style="height: 350px;">
                    <label>依按摩椅型號分析銷售量</label>
                                        <div class="button-container1">
                        <button onclick="showData('week1')">近一週</button>
                        <button onclick="showData('month1')">近一個月</button>
                        <button onclick="showData('year1')">近一年</button>
                    </div>
                    <div style="width: 300px; height: 300px;">
                    <canvas id="lineChart1"></canvas></div>
                </div>
                <div class="chart" style="height: 355px;">
                    <label>依銷售員業績總額分析</label>
                    <div class="button-container1">
                        <button id="weeklyButton2">近一週</button>
                        <button id="monthlyButton2">近一個月</button>
                        <button id="yearlyButton2">近一年</button>
                    </div>
                    <canvas id="salesChart1" width="300" height="250"></canvas>

                </div>
            </div>
        </div>

        <div class="section section-c" id="section-c">
            <div class="section-title">C. KPI分析</div>
            <div class="subsection">
                <!-- 折線圖 -->
                <div class="chart">
                    <label>財務健康分析</label>
                    <div class="fixW">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="subsection">
                <div class="chart">
                    <label>各年齡性別的顧客滿意度分析</label>
                    <div class="fixW">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="subsection">
                <div class="chart">
                    <label>行銷觸及數分析</label>
                    <span class="buttons btn-group" role="group">
                        <button class="btn btn-secondary" onclick="updateChart('week')">週</button>
                        <button class="btn btn-secondary" onclick="updateChart('month')">月</button>
                        <button class="btn btn-secondary" onclick="updateChart('year')">年</button>
                    </span>
                    <div class="fixW">
                        <canvas id="kpiChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="section section-d" id="section-d">
            <div class="section-title">D. 日常營運項目</div>
            <div class="subsection">
                <div class="chart" data-container="massageChairChart">
                    <label>2023年6月份按摩椅營運狀況-全地區</label>
                    <canvas data-chart-type="bar" data-chart="massageChairAll"></canvas>
                </div>
            </div>
            <div class="subsection">
                <div class="chart" data-container="aimChart">
                    <label>2023年6月份業務員目標</label>
                    <canvas data-chart-type="bar" data-chart="aim"></canvas>
                </div>
            </div>
            <div class="subsection">
                <div class="chart" data-container="touchTable">
                    <label>潛在顧客接觸點</label>
                    <table border="1px">
                        <thead>
                            <tr>
                                <td>專案編號</td>
                                <td>會員姓名</td>
                                <td>專案起始日</td>
                                <td>專案結束日</td>
                                <td>接觸次數</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span data-project-id>P176593758139</span></td>
                                <td>習大大</td>
                                <td>2023-06-04</td>
                                <td>-</td>
                                <td>10</td>
                            </tr>
                            <tr>
                                <td><span data-project-id>P176593776044</span></td>
                                <td>李大大</td>
                                <td>2023-06-07</td>
                                <td>-</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td><span data-project-id>P176593738561</span></td>
                                <td>劉大大</td>
                                <td>2023-06-11</td>
                                <td>-</td>
                                <td>4</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <script>
        /*潛在客戶漏斗分析*/
        var funnelChart;
        window.onload = () => {
            const dataValues = [500, 294, 63];
            const maxDataValue = Math.max(...dataValues);
            const percentages = dataValues.map(value => ((value / maxDataValue) * 100).toFixed(2));
            const funnel_chart = document.getElementById("funnelchart").getContext("2d");
            funnelChart = new Chart(funnel_chart, {
                type: 'funnel',
                data: {
                    labels: ['參與實體銷售會人數/公共按摩椅者/廣告觸及次數', '加入會員/到店使用體驗券', '購買按摩椅的忠實顧客'],
                    datasets: [{
                        data: percentages,
                        backgroundColor: ['#ff6384', '#36a2eb', '#ffce56']
                    }]
                },
                options: {
                    indexAxis: 'y',
                    title: {
                        display: true,
                        text: 'Chart.js Funnel Chart'
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            font: {
                                size: '10px',
                                weight: 'bold'
                            },
                            color: '#000000',
                            formatter: function (value) {
                                return value + '%';
                            }
                        }
                    },
                    tooltips: {
                        callbacks: {
                            label: function (context) {
                                const value = context.raw;
                                const percentage = (value / maxDataValue * 100).toFixed(2);
                                return percentage + '%';
                            }
                        }
                    },
                    legend: {
                        display: false
                    }
                },
                plugins: [ChartDataLabels]
            });
        };

        function toggleDataset(datasetIndex) {
            funnelChart.getDatasetMeta(0).data[datasetIndex].hidden = !funnelChart.getDatasetMeta(0).data[
                    datasetIndex]
                .hidden;
            funnelChart.update();
        }

        /*潛在客戶來源*/
        var client_piechart = document.getElementById('clientpiechart').getContext('2d');
        var dataValues = [66, 99, 150];
        var sum = dataValues.reduce((a, b) => a + b, 0);
        var percentages = dataValues.map(data => ((data / sum) * 100).toFixed(2));
        var data = {
            labels: ['忠實顧客', '透過會員介紹', '加入APP會員'],
            datasets: [{
                data: percentages,
                backgroundColor: ['#ff6384', '#36a2eb', '#ffce56']
            }]
        };
        var options = {
            plugins: {
                datalabels: {
                    color: '#000000',
                    font: {
                        size: '14px',
                        weight: 'bold'
                    },
                    formatter: function (value, context) {
                        return value + '%';
                    }
                }
            },
            legend: {
                display: true,
                position: 'bottom'
            }
        };
        var myPieChart = new Chart(client_piechart, {
            type: 'pie',
            data: data,
            options: options,
            plugins: [ChartDataLabels]
        });

        /*依按摩椅型號分析銷售量*/
        const salesData1 = {
            week1: {
                labels: ['06/11', '06/12', '06/13', '06/14', '06/15', '06/16', '06/17'],
                datasets: [{
                        label: 'A01',
                        data: [10, 8, 12, 9, 11, 7, 10],
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },
                    {
                        label: 'A02',
                        data: [5, 6, 4, 3, 4, 5, 6],
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'A03',
                        data: [3, 4, 2, 2, 3, 4, 3],
                        borderColor: 'rgba(255, 206, 86, 1)'
                    },
                    {
                        label: 'A04',
                        data: [8, 7, 6, 5, 6, 7, 8],
                        borderColor: 'rgba(75, 192, 192, 1)'
                    }
                ]
            },
            month1: {
                labels: ['第1週', '第2週', '第3週', '第4週'],
                datasets: [{
                        label: 'A01',
                        data: [50, 45, 55, 60],
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },
                    {
                        label: 'A02',
                        data: [30, 35, 40, 45],
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'A03',
                        data: [20, 25, 28, 30],
                        borderColor: 'rgba(255, 206, 86, 1)'
                    },
                    {
                        label: 'A04',
                        data: [40, 38, 42, 50],
                        borderColor: 'rgba(75, 192, 192, 1)'
                    }
                ]
            },
            year1: {
                labels: ['7月', '8月', '9月', '10月', '11月', '12月', '1月', '2月', '3月', '4月', '5月', '6月'],
                datasets: [{
                        label: 'A01',
                        data: [100, 120, 130, 110, 95, 150, 180, 200, 220, 190, 210, 220],
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },
                    {
                        label: 'A02',
                        data: [80, 90, 95, 85, 70, 110, 130, 150, 160, 140, 160, 170],
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'A03',
                        data: [70, 80, 85, 75, 60, 100, 120, 130, 140, 120, 130, 150],
                        borderColor: 'rgba(255, 206, 86, 1)'
                    },
                    {
                        label: 'A04',
                        data: [90, 110, 120, 105, 100, 140, 160, 180, 200, 170, 190, 200],
                        borderColor: 'rgba(75, 192, 192, 1)'
                    }
                ]
            }
        };
        const saleschartData1 = document.getElementById('lineChart1').getContext('2d');
        const lineChart1 = new Chart(saleschartData1, {
            type: 'line',
            data: salesData1.week1,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        function showData(interval) {
            lineChart1.data = salesData1[interval];
            lineChart1.update();
        }

        /*依銷售員業績總額分析*/
        const weeklyData2 = {
            labels: ['薰衣草', '庭酸', '遷移', '試驗'],
            datasets: [{
                label: '總銷售額',
                data: [160000, 240000, 200000, 120000],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        const monthlyData2 = {
            labels: ['薰衣草', '庭酸', '遷移', '試驗'],
            datasets: [{
                label: '總銷售額',
                data: [800000, 700000, 900000, 600000],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };

        const yearlyData2 = {
            labels: ['薰衣草', '庭酸', '遷移', '試驗'],
            datasets: [{
                label: '總銷售額',
                data: [7550000, 6000000, 4500000, 5500000],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        };

        const salesChart2data = document.getElementById('salesChart1').getContext('2d');
        const salesChart1 = new Chart(salesChart2data, {
            type: 'bar',
            data: weeklyData2,
            options: {
                responsive: true,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value, index, values) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        const weeklyButton2 = document.getElementById('weeklyButton2');
        weeklyButton2.addEventListener('click', function () {
            salesChart1.data = weeklyData2;
            salesChart1.update();
        });

        const monthlyButton2 = document.getElementById('monthlyButton2');
        monthlyButton2.addEventListener('click', function () {
            salesChart1.data = monthlyData2;
            salesChart1.update();
        });

        const yearlyButton2 = document.getElementById('yearlyButton2');
        yearlyButton2.addEventListener('click', function () {
            salesChart1.data = yearlyData2;
            salesChart1.update();
        });
        // 行銷 KPI1 折線圖資料

        // 假設的數據
        const websiteData = [100, 150, 120, 180, 200, 160, 220];
        const fbData = [80, 100, 90, 120, 110, 130, 150];
        const igData = [50, 60, 70, 80, 90, 100, 110];
        const dates = ['2023/06/11', '2023/06/12', '2023/06/13', '2023/06/14', '2023/06/15', '2023/06/16',
            '2023/06/17'
        ];

        // 初始化折線圖
        const ctx = document.getElementById('kpiChart').getContext('2d');
        let kpiChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                        label: '網站',
                        data: websiteData,
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        fill: false
                    },
                    {
                        label: 'FB',
                        data: fbData,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        fill: false
                    },
                    {
                        label: 'IG',
                        data: igData,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // 更新圖表
        function updateChart(type) {
            let newData = [];
            let newLabels = [];

            switch (type) {
                case 'week':
                    newData = websiteData.slice(0, 7);
                    newLabels = dates.slice(0, 7);
                    break;
                case 'month':
                    newData = websiteData.slice(0, 4);
                    newLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    break;
                case 'year':
                    newData = websiteData.slice(0, 12);
                    newLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov',
                        'Dec'
                    ];
                    break;
                default:
                    newData = websiteData;
                    newLabels = dates;
            }

            kpiChart.data.labels = newLabels;
            kpiChart.data.datasets[0].data = newData;
            kpiChart.update();
        }

        // 行銷 KPI2 長條圖資料

        var ageData = [20, 25, 30, 35, 40, 45, 50];
        var satisfactionData = [];
        var labels = [];
        var barChart;

        function getRandomSatisfaction() {
            return Math.floor(Math.random() * 10) + 1;
        }

        function generateData() {
            satisfactionData = [];
            labels = [];

            for (var i = 0; i < ageData.length; i++) {
                var age = ageData[i];
                var maleSatisfaction = getRandomSatisfaction();
                var femaleSatisfaction = getRandomSatisfaction();

                satisfactionData.push({
                    age: age,
                    maleSatisfaction: maleSatisfaction,
                    femaleSatisfaction: femaleSatisfaction
                });

                labels.push('年齡' + age);
            }
        }

        function createBarChart() {
            var ctx2 = document.getElementById('barChart').getContext('2d');
            barChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                            label: '男性',
                            data: satisfactionData.map(item => item.maleSatisfaction),
                            backgroundColor: 'rgba(54, 162, 235, 0.8)'
                        },
                        {
                            label: '女性',
                            data: satisfactionData.map(item => item.femaleSatisfaction),
                            backgroundColor: 'rgba(255, 99, 132, 0.8)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: '年齡'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: '顧客服務滿意度'
                            },
                            suggestedMin: 1,
                            suggestedMax: 10
                        }
                    }
                }
            });
        }

        generateData();
        createBarChart();
        //行銷KPI3
        var financialData = {
            labels: ['2019', '2020', '2021', '2022', '2023'],
            revenue: [500000, 600000, 700000, 800000, 900000],
            cost: [350000, 400000, 450000, 500000, 550000],
            profit: [150000, 200000, 250000, 300000, 350000]
        };

        // 繪製財務健康圖
        var ctx3 = document.getElementById('financialChart').getContext('2d');
        var financialChart = new Chart(ctx3, {
            type: 'line',
            data: {
                labels: financialData.labels,
                datasets: [{
                        label: '收入',
                        data: financialData.revenue,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: true
                    },
                    {
                        label: '成本',
                        data: financialData.cost,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        fill: true
                    },
                    {
                        label: '利潤',
                        data: financialData.profit,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: '年份'
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: '金額（美元）'
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>